<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <!--
        ========================================================================
        RECURRING ITEM VIEWS - Cashflow Planning Recurring Items
        ========================================================================

        Pattern Used: patterns/views/form-view.xml
        Pattern Used: patterns/views/tree-view.xml
        Pattern Used: patterns/views/search-view.xml

        Purpose: CRUD interface for recurring cashflow items
        -->

        <!-- ================================================================ -->
        <!-- FORM VIEW -->
        <!-- ================================================================ -->

        <record id="eo_cfp_recurring_item_form_view" model="ir.ui.view">
            <field name="name">eo.cfp.recurring.item.form</field>
            <field name="model">eo.cfp.recurring.item</field>
            <field name="arch" type="xml">
                <form string="Recurring Item" version="7.0">
                    <header>
                        <!-- Action buttons -->
                        <button name="action_generate_now" string="Generate Now" type="object"
                                states="active" class="oe_highlight"/>
                        <button name="action_suspend" string="Suspend" type="object"
                                states="active"/>
                        <button name="action_activate" string="Activate" type="object"
                                states="suspended,expired" class="oe_highlight"/>
                        <button name="action_expire" string="Mark Expired" type="object"
                                states="active,suspended"/>
                        <field name="state" widget="statusbar"
                               statusbar_visible="active,suspended,expired"/>
                    </header>

                    <sheet>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1>
                                <field name="name" placeholder="e.g. Monthly Office Rent"/>
                            </h1>
                        </div>

                        <group>
                            <group>
                                <field name="type" on_change="onchange_type(type, context)"/>
                                <field name="category_id"/>
                                <field name="partner_id"/>
                                <field name="active"/>
                            </group>
                            <group>
                                <field name="amount" widget="monetary"
                                       options="{'currency_field': 'currency_id'}"/>
                                <field name="signed_amount" widget="monetary"
                                       options="{'currency_field': 'currency_id'}"
                                       readonly="1"/>
                                <field name="currency_id" groups="base.group_multi_currency"/>
                            </group>
                        </group>

                        <group string="Recurrence Settings">
                            <group>
                                <field name="recurrence_type"/>
                                <field name="recurrence_interval"/>
                                <label for="next_date"/>
                                <div>
                                    <field name="next_date" class="oe_inline"/>
                                    <span class="oe_grey"> (computed)</span>
                                </div>
                            </group>
                            <group>
                                <field name="start_date"/>
                                <field name="end_date"/>
                                <field name="auto_generate"/>
                                <field name="days_in_advance"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Internal Notes">
                                <field name="notes" placeholder="Notes about this recurring item..."/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- ================================================================ -->
        <!-- TREE VIEW -->
        <!-- ================================================================ -->

        <record id="eo_cfp_recurring_item_tree_view" model="ir.ui.view">
            <field name="name">eo.cfp.recurring.item.tree</field>
            <field name="model">eo.cfp.recurring.item</field>
            <field name="arch" type="xml">
                <tree string="Recurring Items"
                      colors="blue:type=='income';red:type=='payment';gray:state!='active' or active==False">
                    <field name="name"/>
                    <field name="type"/>
                    <field name="category_id"/>
                    <field name="amount" sum="Total Amount"/>
                    <field name="signed_amount" sum="Net Impact"/>
                    <field name="currency_id" groups="base.group_multi_currency"/>
                    <field name="recurrence_type"/>
                    <field name="recurrence_interval"/>
                    <field name="next_date"/>
                    <field name="state"/>
                    <field name="active" invisible="1"/>
                    <button name="action_generate_now" string="Generate" type="object"
                            states="active" icon="gtk-execute"/>
                </tree>
            </field>
        </record>

        <!-- ================================================================ -->
        <!-- SEARCH VIEW -->
        <!-- ================================================================ -->

        <record id="eo_cfp_recurring_item_search_view" model="ir.ui.view">
            <field name="name">eo.cfp.recurring.item.search</field>
            <field name="model">eo.cfp.recurring.item</field>
            <field name="arch" type="xml">
                <search string="Search Recurring Items">
                    <!-- Search fields -->
                    <field name="name"
                           filter_domain="['|', ('name', 'ilike', self), ('notes', 'ilike', self)]"/>
                    <field name="category_id"/>
                    <field name="partner_id"/>

                    <!-- Type Filters -->
                    <filter string="Income" name="filter_income"
                            domain="[('type', '=', 'income')]"
                            icon="terp-camera_test"/>
                    <filter string="Payment" name="filter_payment"
                            domain="[('type', '=', 'payment')]"
                            icon="terp-dolar"/>

                    <separator/>

                    <!-- State Filters -->
                    <filter string="Active" name="filter_active"
                            domain="[('state', '=', 'active')]"
                            icon="terp-check"
                            help="Currently active recurring items"/>
                    <filter string="Suspended" name="filter_suspended"
                            domain="[('state', '=', 'suspended')]"
                            help="Temporarily suspended items"/>
                    <filter string="Expired" name="filter_expired"
                            domain="[('state', '=', 'expired')]"
                            icon="terp-dialog-close"
                            help="Expired recurring items"/>

                    <separator/>

                    <!-- Recurrence Filters -->
                    <filter string="Daily" name="filter_daily"
                            domain="[('recurrence_type', '=', 'daily')]"/>
                    <filter string="Weekly" name="filter_weekly"
                            domain="[('recurrence_type', '=', 'weekly')]"/>
                    <filter string="Monthly" name="filter_monthly"
                            domain="[('recurrence_type', '=', 'monthly')]"/>
                    <filter string="Yearly" name="filter_yearly"
                            domain="[('recurrence_type', '=', 'yearly')]"/>

                    <separator/>

                    <!-- Auto Generation Filter -->
                    <filter string="Auto Generate" name="filter_auto_generate"
                            domain="[('auto_generate', '=', True)]"
                            help="Items with automatic generation enabled"/>

                    <!-- Group By -->
                    <group expand="0" string="Group By">
                        <filter string="Type" name="group_type"
                                context="{'group_by': 'type'}"/>
                        <filter string="Category" name="group_category"
                                context="{'group_by': 'category_id'}"/>
                        <filter string="State" name="group_state"
                                context="{'group_by': 'state'}"/>
                        <filter string="Recurrence Type" name="group_recurrence"
                                context="{'group_by': 'recurrence_type'}"/>
                        <filter string="Partner" name="group_partner"
                                context="{'group_by': 'partner_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- ================================================================ -->
        <!-- ACTION -->
        <!-- ================================================================ -->

        <record id="action_eo_cfp_recurring_item" model="ir.actions.act_window">
            <field name="name">Recurring Items</field>
            <field name="res_model">eo.cfp.recurring.item</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="eo_cfp_recurring_item_tree_view"/>
            <field name="search_view_id" ref="eo_cfp_recurring_item_search_view"/>
            <field name="context">{'search_default_filter_active': 1}</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to create a new recurring item.
                </p>
                <p>
                    Recurring items automatically generate planned items on a regular schedule.
                    Perfect for predictable regular transactions like:
                </p>
                <ul>
                    <li><b>Monthly:</b> Rent, salaries, subscriptions</li>
                    <li><b>Weekly:</b> Cleaning services, weekly deliveries</li>
                    <li><b>Yearly:</b> Insurance, licenses, annual fees</li>
                </ul>
                <p>
                    <b>Workflow:</b>
                </p>
                <ul>
                    <li><b>Active:</b> Generating planned items automatically</li>
                    <li><b>Suspended:</b> Temporarily disabled (e.g., during vacation)</li>
                    <li><b>Expired:</b> End date reached, no longer generating</li>
                </ul>
                <p>
                    Use the <b>"Generate Now"</b> button to manually create a planned item immediately.
                </p>
            </field>
        </record>

        <!-- Menu item defined in views/eo_cfp_menu.xml -->

    </data>
</openerp>
