<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <!--
        ========================================================================
        CATEGORY VIEWS - Cashflow Planning Categories
        ========================================================================

        Pattern Used: patterns/views/form-view.xml
        Pattern Used: patterns/views/tree-view.xml
        Pattern Used: patterns/views/search-view.xml
        Pattern Used: patterns/views/menu-action.xml

        Purpose: CRUD interface for hierarchical categories
        -->

        <!-- ================================================================ -->
        <!-- FORM VIEW -->
        <!-- ================================================================ -->

        <record id="eo_cfp_category_form_view" model="ir.ui.view">
            <field name="name">eo.cfp.category.form</field>
            <field name="model">eo.cfp.category</field>
            <field name="arch" type="xml">
                <form string="Cashflow Category" version="7.0">
                    <sheet>
                        <group>
                            <group>
                                <field name="name" placeholder="e.g. Office Rent"/>
                                <field name="code" placeholder="e.g. RENT"/>
                                <field name="type"/>
                                <field name="parent_id"
                                       on_change="onchange_parent_id(parent_id, context)"
                                       context="{'tree_view_ref': 'eo_cashflow_planner_v2.eo_cfp_category_tree_view'}"/>
                            </group>
                            <group>
                                <field name="active"/>
                                <field name="sequence"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Description">
                                <group>
                                    <field name="description" placeholder="What types of items belong in this category?"/>
                                </group>
                            </page>

                            <page string="Child Categories">
                                <field name="child_ids" mode="tree">
                                    <tree string="Child Categories" editable="bottom">
                                        <field name="sequence"/>
                                        <field name="name"/>
                                        <field name="code"/>
                                        <field name="active"/>
                                    </tree>
                                </field>
                            </page>

                            <page string="Internal Notes">
                                <field name="notes" placeholder="Internal notes for accountants/managers..."/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- ================================================================ -->
        <!-- TREE VIEW -->
        <!-- ================================================================ -->

        <record id="eo_cfp_category_tree_view" model="ir.ui.view">
            <field name="name">eo.cfp.category.tree</field>
            <field name="model">eo.cfp.category</field>
            <field name="arch" type="xml">
                <tree string="Cashflow Categories" colors="blue:type=='income';gray:active==False">
                    <field name="sequence"/>
                    <field name="name"/>
                    <field name="code"/>
                    <field name="type"/>
                    <field name="parent_id"/>
                    <field name="active"/>
                </tree>
            </field>
        </record>

        <!-- ================================================================ -->
        <!-- SEARCH VIEW -->
        <!-- ================================================================ -->

        <record id="eo_cfp_category_search_view" model="ir.ui.view">
            <field name="name">eo.cfp.category.search</field>
            <field name="model">eo.cfp.category</field>
            <field name="arch" type="xml">
                <search string="Search Categories">
                    <!-- Search fields -->
                    <field name="name" filter_domain="['|', ('name', 'ilike', self), ('code', 'ilike', self)]"/>
                    <field name="code"/>
                    <field name="parent_id"/>

                    <!-- Filters -->
                    <filter string="Income" name="filter_income" domain="[('type', '=', 'income')]"
                            icon="terp-camera_test" help="Income categories"/>
                    <filter string="Payment" name="filter_payment" domain="[('type', '=', 'payment')]"
                            icon="terp-dolar" help="Payment/expense categories"/>

                    <separator/>

                    <filter string="Active" name="filter_active" domain="[('active', '=', True)]"/>
                    <filter string="Inactive" name="filter_inactive" domain="[('active', '=', False)]"/>

                    <separator/>

                    <filter string="Root Categories" name="filter_root" domain="[('parent_id', '=', False)]"
                            help="Categories without a parent"/>
                    <filter string="Sub-Categories" name="filter_children" domain="[('parent_id', '!=', False)]"
                            help="Categories with a parent"/>

                    <!-- Group By -->
                    <group expand="0" string="Group By">
                        <filter string="Type" name="group_type" context="{'group_by': 'type'}"/>
                        <filter string="Parent Category" name="group_parent" context="{'group_by': 'parent_id'}"/>
                        <filter string="Active Status" name="group_active" context="{'group_by': 'active'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- ================================================================ -->
        <!-- ACTION -->
        <!-- ================================================================ -->

        <record id="action_eo_cfp_category" model="ir.actions.act_window">
            <field name="name">Cashflow Categories</field>
            <field name="res_model">eo.cfp.category</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="eo_cfp_category_tree_view"/>
            <field name="search_view_id" ref="eo_cfp_category_search_view"/>
            <field name="context">{'search_default_filter_active': 1}</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to create a new cashflow category.
                </p>
                <p>
                    Categories help organize your cashflow planning items into logical groups.
                    You can create hierarchical structures (parent/child relationships) to
                    organize categories at multiple levels.
                </p>
                <p>
                    Examples:
                    <ul>
                        <li><b>Income:</b> Sales Revenue, Consulting Fees, Interest Income</li>
                        <li><b>Payment:</b> Salaries, Office Rent, Utilities, Marketing</li>
                    </ul>
                </p>
            </field>
        </record>

        <!-- ================================================================ -->
        <!-- MENU ITEM (Moved to eo_cfp_menu.xml) -->
        <!-- ================================================================ -->
        <!-- Menu is defined in eo_cfp_menu.xml after parent menu exists -->

    </data>
</openerp>

